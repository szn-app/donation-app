apiVersion: skaffold/v4beta12
kind: Config
metadata:
  name: api-data
build:
  local: 
    push: false
  tagPolicy:
    sha256: {} 

deploy:
  kubectl: {}
  statusCheck: true
  
portForward:
  - resourceType: service
    resourceName: api-data
    port: service-api-data
    localPort: 8084

profiles:

- name: development
  activation:
    - kubeContext: minikube
      
  build: 
    artifacts:
    - image: api-data
      context: .
      docker:
        target: development
        dockerfile: Dockerfile
        buildArgs: {}
      # NOTE: limitations https://skaffold.dev/docs/filesync/#limitations
      sync:
        manual:
        - src: "src/**/*.rs"
          dest: .
  manifests:
    kustomize:
      paths:
      - k8s/overlays/dev
  deploy:
    kubeContext: minikube

- name: production

  build: 
    artifacts:
    - image: api-data
      context: .
      docker:
        target: production
        dockerfile: Dockerfile
        buildArgs: {}
  manifests:
    kustomize:
      paths:
      - k8s/overlays/prod
  deploy:
    kubeContext: minikube
